package PrPixelCudaTest
version v1r1
author "Alexey Badalov"

# structure
branches cmt src $(target_src)

# dependencies
use GaudiPolicy *
use Boost       * LCG_Interfaces -no_auto_imports

# application constituent
application PrPixelCudaTest -import=Boost \
  *.cpp                                   \
  $(target_src)/KernelPreprocessing.cpp   \
  $(target_src)/Kernel.cu

private

# remove the silly extension
macro application_suffix ""

# reference the sources to be tested
macro target_src $(PrPixelCudaTest_root)/../PrPixelCuda/src
include_dirs $(target_src)

# add support for .cu files
language c++ -suffix=cpp -suffix=cu -linker=$(cpplink) -fragment=cpp -dependencies_options=$(cppdepflags)
macro_append use_cppflags " -x c++"

# set compiler flags
macro_append use_cppflags " -g"
macro_append use_cppflags " -DBOOST_TEST_DYN_LINK"
macro_append use_cppflags " -DCUDA_TEST"
macro_append use_cppflags " -I../src"
macro_append use_cppflags " -Wno-missing-field-initializers"
macro_append use_cppflags " -std=c++11"

# add Boost libraries
macro Boost_linkopts_timer               " -lboost_timer-$(Boost_compiler_version)-mt-$(Boost_file_version) "
macro Boost_linkopts_unit_test_framework " -lboost_unit_test_framework-$(Boost_compiler_version)-mt-$(Boost_file_version) "

macro_append Boost_linkopts " $(Boost_linkopts_timer)"
macro_append Boost_linkopts " $(Boost_linkopts_unit_test_framework)"
end_private
